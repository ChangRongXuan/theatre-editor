{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import studio from'@theatre/studio';import{val,getProject}from'@theatre/core';import{useState,useEffect,useRef}from'react';import styled from'styled-components';import Stage from'../components/stage';import{renderFontObject,renderImageObject,renderBgObject}from'../utils';import{jsx as _jsx}from\"react/jsx-runtime\";var ViewBox=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  position: relative;\\n  width: 100vw;\\n  min-width: 100vw;\\n  max-width: 100vw;\\n  min-height: 100vh;\\n  background: #ffffff;\\n\"])));var StageWrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n  position: sticky;\\n  top: 0;\\n  left: 0;\\n\"])));var defaultScrollScale=1500;export default function DemoScroll(){studio.initialize();studio.ui.hide();var project=getProject('Project',{});var sheet=project.sheet('Scene','default');project.ready.then(function(){return sheet.sequence.pause();});// --------------------------\n// TODO: 增加條件，減少 event-listener 偵測時間\nvar _useState=useState(0),_useState2=_slicedToArray(_useState,2),scrollPosition=_useState2[0],setScrollPosition=_useState2[1];var sequenceLength=val(sheet.sequence.pointer.length);//總長度\nvar stageRef=useRef(null);useEffect(function(){var handleScroll=function handleScroll(){var stage=stageRef.current;var viewbox=stage.closest('.theatre-scroll-viewbox');var stageRect=stage.getBoundingClientRect();var viewboxRect=viewbox.getBoundingClientRect();var distance=stageRect.top-viewboxRect.top;setScrollPosition(distance);};window.addEventListener('scroll',handleScroll);return function(){window.removeEventListener('scroll',handleScroll);};},[]);useEffect(function(){var newPosition=scrollPosition/(sequenceLength*defaultScrollScale)*sequenceLength;sheet.sequence.position=newPosition;},[scrollPosition]);// get objectJSON in local-storage\nvar objJson=localStorage.getItem('theatre-data');var storedData=objJson?JSON.parse(objJson):[];useEffect(function(){if(storedData.length>0){renderFontObject(storedData,sheet);renderImageObject(storedData,sheet);renderBgObject(storedData,sheet);}},[storedData]);return/*#__PURE__*/_jsx(ViewBox,{className:\"theatre-scroll-viewbox\",style:{height:\"\".concat(sequenceLength*defaultScrollScale,\"px\")},children:/*#__PURE__*/_jsx(StageWrapper,{ref:stageRef,children:/*#__PURE__*/_jsx(Stage,{storedData:storedData})})});}","map":{"version":3,"names":["studio","val","getProject","useState","useEffect","useRef","styled","Stage","renderFontObject","renderImageObject","renderBgObject","jsx","_jsx","ViewBox","div","_templateObject","_taggedTemplateLiteral","StageWrapper","_templateObject2","defaultScrollScale","DemoScroll","initialize","ui","hide","project","sheet","ready","then","sequence","pause","_useState","_useState2","_slicedToArray","scrollPosition","setScrollPosition","sequenceLength","pointer","length","stageRef","handleScroll","stage","current","viewbox","closest","stageRect","getBoundingClientRect","viewboxRect","distance","top","window","addEventListener","removeEventListener","newPosition","position","objJson","localStorage","getItem","storedData","JSON","parse","className","style","height","concat","children","ref"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\nimport { renderFontObject, renderImageObject, renderBgObject } from '../utils';\n\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  background: #ffffff;\n`;\n\nconst StageWrapper = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n\nconst defaultScrollScale = 1500;\n\nexport default function DemoScroll() {\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  const sequenceLength = val(sheet.sequence.pointer.length); //總長度\n  const stageRef = useRef(null);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const viewbox = stage.closest('.theatre-scroll-viewbox');\n\n      const stageRect = stage.getBoundingClientRect();\n      const viewboxRect = viewbox.getBoundingClientRect();\n\n      const distance = stageRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    const newPosition =\n      (scrollPosition / (sequenceLength * defaultScrollScale)) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  // get objectJSON in local-storage\n  const objJson = localStorage.getItem('theatre-data');\n  const storedData = objJson ? JSON.parse(objJson) : [];\n\n  useEffect(() => {\n    if (storedData.length > 0) {\n      renderFontObject(storedData, sheet);\n      renderImageObject(storedData, sheet);\n      renderBgObject(storedData, sheet);\n    }\n  }, [storedData]);\n\n  return (\n    <ViewBox\n      className='theatre-scroll-viewbox'\n      style={{ height: `${sequenceLength * defaultScrollScale}px` }}\n    >\n      <StageWrapper ref={stageRef}>\n        <Stage storedData={storedData} />\n      </StageWrapper>\n    </ViewBox>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}