{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/GitHub/deepfake-demo/src/page/scroll.js\",\n  _s = $RefreshSig$();\nimport studio from '@theatre/studio';\nimport { getProject, val } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport TheatreElements from '../components/theatre-elements';\n\n// import { getProject, types } from '@theatre/core';\nimport projectState from '../json/state.json';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst defaultViewportHeight = '100vh';\nconst ViewBox = styled.div`\n  position: sticky;\n  width: 100%;\n  height: 100vh;\n  overflow: hidden;\n`;\n_c = ViewBox;\nconst TheatreContainer = styled.div`\n  width: 100%;\n  height: 100%;\n  outline: 5px solid red;\n  overflow-y: auto;\n  padding-right: 15px; //to hide scroll-bar\n`;\n_c2 = TheatreContainer;\nconst ScrollHeight = styled.div`\n  background: pink;\n  width: 100%;\n  height: 200vh;\n`;\n\n// 下面參考 scrollable-video ---------------------------------\n_c3 = ScrollHeight;\nconst PositionStarter = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n_c4 = PositionStarter;\nconst PositionFinisher = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n_c5 = PositionFinisher;\nconst Other = styled.div`\n  width: 100%;\n  height: 100vh;\n`;\n_c6 = Other;\nexport default function ScrollDemo() {\n  _s();\n  studio.initialize();\n  const project = getProject('deepfake demo', {\n    state: projectState\n  });\n  const sheet = project.sheet('Scene', 'default');\n  studio.ui.hide();\n  project.ready.then(() => sheet.sequence.pause);\n\n  // ------------------------------------------------\n\n  const starterRef = useRef(null);\n  const finisherRef = useRef(null);\n  const theatreRef = useRef(null);\n  const observerRef = useRef(null);\n\n  //滑動的離頂端有多少距離\n  const [innerScrollTop, setInnerScrollTop] = useState(0);\n  console.log('innerScrollTop', innerScrollTop);\n\n  // useEffect(() => {\n  //   const container = theatreRef.current;\n\n  //   const handleInnerScroll = () => {\n  //     const currentPosition = container.scrollTop;\n  //     setInnerScrollTop(currentPosition);\n  //   };\n\n  //   container.addEventListener('inner-scroll-top', handleInnerScroll);\n\n  //   return () => {\n  //     container.removeEventListener('inner-scroll-top', handleInnerScroll);\n  //   };\n  // }, []);\n\n  useEffect(() => {\n    const container = theatreRef.current;\n    const handleInnerScroll = () => {\n      const currentPosition = container.scrollTop;\n      setInnerScrollTop(currentPosition);\n    };\n    const handleIntersection = entries => {\n      const isIntersecting = entries[0].isIntersecting;\n      if (isIntersecting) {\n        container.addEventListener('inner-scroll-top', handleInnerScroll);\n      } else {\n        container.removeEventListener('inner-scroll-top', handleInnerScroll);\n      }\n    };\n    observerRef.current = new IntersectionObserver(handleIntersection);\n    observerRef.current.observe(container);\n    return () => {\n      observerRef.current.disconnect();\n      container.removeEventListener('inner-scroll-top', handleInnerScroll);\n    };\n  }, []);\n  const [scrollEnabled, setScrollEnabled] = useState(false);\n  const sequenceLength = val(sheet.sequence.pointer.length);\n  useEffect(() => {\n    // 2000 等同於 ScrollHeight 元件的高度\n    sheet.sequence.position = innerScrollTop / 2000 * sequenceLength;\n  }, [innerScrollTop]);\n\n  // ------------------------------------------------\n\n  const handleScrollEnable = () => {\n    const starterRect = starterRef.current.getBoundingClientRect();\n    const isAtTop = starterRect.top <= 0;\n    console.log('starterRect.top', starterRect.top);\n    console.log('isAtTop', isAtTop);\n    setScrollEnabled(isAtTop);\n  };\n  useEffect(() => {\n    const handleScroll = () => {\n      handleScrollEnable();\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Other, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PositionStarter, {\n      ref: starterRef,\n      id: \"starter\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ViewBox, {\n      style: {\n        top: scrollEnabled ? '0' : 'auto',\n        zIndex: scrollEnabled ? '1' : 'auto'\n      },\n      children: /*#__PURE__*/_jsxDEV(TheatreContainer, {\n        id: \"theatre-container\",\n        ref: theatreRef,\n        style: {\n          overflow: scrollEnabled ? 'auto' : 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(TheatreElements, {\n          sheet: sheet\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(ScrollHeight, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PositionFinisher, {\n      ref: finisherRef,\n      id: \"finisher\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Other, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(ScrollDemo, \"w1itxeIC1PhGBgsXVKV6938YkDI=\");\n_c7 = ScrollDemo;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7;\n$RefreshReg$(_c, \"ViewBox\");\n$RefreshReg$(_c2, \"TheatreContainer\");\n$RefreshReg$(_c3, \"ScrollHeight\");\n$RefreshReg$(_c4, \"PositionStarter\");\n$RefreshReg$(_c5, \"PositionFinisher\");\n$RefreshReg$(_c6, \"Other\");\n$RefreshReg$(_c7, \"ScrollDemo\");","map":{"version":3,"names":["studio","getProject","val","useState","useEffect","useRef","styled","TheatreElements","projectState","jsxDEV","_jsxDEV","Fragment","_Fragment","defaultViewportHeight","ViewBox","div","_c","TheatreContainer","_c2","ScrollHeight","_c3","PositionStarter","_c4","PositionFinisher","_c5","Other","_c6","ScrollDemo","_s","initialize","project","state","sheet","ui","hide","ready","then","sequence","pause","starterRef","finisherRef","theatreRef","observerRef","innerScrollTop","setInnerScrollTop","console","log","container","current","handleInnerScroll","currentPosition","scrollTop","handleIntersection","entries","isIntersecting","addEventListener","removeEventListener","IntersectionObserver","observe","disconnect","scrollEnabled","setScrollEnabled","sequenceLength","pointer","length","position","handleScrollEnable","starterRect","getBoundingClientRect","isAtTop","top","handleScroll","window","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","id","style","zIndex","overflow","_c7","$RefreshReg$"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { getProject, val } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport TheatreElements from '../components/theatre-elements';\n\n// import { getProject, types } from '@theatre/core';\nimport projectState from '../json/state.json';\n\nconst defaultViewportHeight = '100vh';\n\nconst ViewBox = styled.div`\n  position: sticky;\n  width: 100%;\n  height: 100vh;\n  overflow: hidden;\n`;\n\nconst TheatreContainer = styled.div`\n  width: 100%;\n  height: 100%;\n  outline: 5px solid red;\n  overflow-y: auto;\n  padding-right: 15px; //to hide scroll-bar\n`;\n\nconst ScrollHeight = styled.div`\n  background: pink;\n  width: 100%;\n  height: 200vh;\n`;\n\n// 下面參考 scrollable-video ---------------------------------\n\nconst PositionStarter = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n\nconst PositionFinisher = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n\nconst Other = styled.div`\n  width: 100%;\n  height: 100vh;\n`;\n\nexport default function ScrollDemo() {\n  studio.initialize();\n  const project = getProject('deepfake demo', { state: projectState });\n  const sheet = project.sheet('Scene', 'default');\n\n  studio.ui.hide();\n  project.ready.then(() => sheet.sequence.pause);\n\n  // ------------------------------------------------\n\n  const starterRef = useRef(null);\n  const finisherRef = useRef(null);\n  const theatreRef = useRef(null);\n  const observerRef = useRef(null);\n\n  //滑動的離頂端有多少距離\n  const [innerScrollTop, setInnerScrollTop] = useState(0);\n\n  console.log('innerScrollTop', innerScrollTop);\n\n  // useEffect(() => {\n  //   const container = theatreRef.current;\n\n  //   const handleInnerScroll = () => {\n  //     const currentPosition = container.scrollTop;\n  //     setInnerScrollTop(currentPosition);\n  //   };\n\n  //   container.addEventListener('inner-scroll-top', handleInnerScroll);\n\n  //   return () => {\n  //     container.removeEventListener('inner-scroll-top', handleInnerScroll);\n  //   };\n  // }, []);\n\n  useEffect(() => {\n    const container = theatreRef.current;\n\n    const handleInnerScroll = () => {\n      const currentPosition = container.scrollTop;\n      setInnerScrollTop(currentPosition);\n    };\n\n    const handleIntersection = (entries) => {\n      const isIntersecting = entries[0].isIntersecting;\n\n      if (isIntersecting) {\n        container.addEventListener('inner-scroll-top', handleInnerScroll);\n      } else {\n        container.removeEventListener('inner-scroll-top', handleInnerScroll);\n      }\n    };\n\n    observerRef.current = new IntersectionObserver(handleIntersection);\n\n    observerRef.current.observe(container);\n\n    return () => {\n      observerRef.current.disconnect();\n      container.removeEventListener('inner-scroll-top', handleInnerScroll);\n    };\n  }, []);\n\n  const [scrollEnabled, setScrollEnabled] = useState(false);\n\n  const sequenceLength = val(sheet.sequence.pointer.length);\n\n  useEffect(() => {\n    // 2000 等同於 ScrollHeight 元件的高度\n    sheet.sequence.position = (innerScrollTop / 2000) * sequenceLength;\n  }, [innerScrollTop]);\n\n  // ------------------------------------------------\n\n  const handleScrollEnable = () => {\n    const starterRect = starterRef.current.getBoundingClientRect();\n    const isAtTop = starterRect.top <= 0;\n\n    console.log('starterRect.top', starterRect.top);\n    console.log('isAtTop', isAtTop);\n\n    setScrollEnabled(isAtTop);\n  };\n\n  useEffect(() => {\n    const handleScroll = () => {\n      handleScrollEnable();\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  return (\n    <>\n      <Other />\n      <PositionStarter ref={starterRef} id='starter' />\n      <ViewBox\n        style={{\n          top: scrollEnabled ? '0' : 'auto',\n          zIndex: scrollEnabled ? '1' : 'auto',\n        }}\n      >\n        <TheatreContainer\n          id='theatre-container'\n          ref={theatreRef}\n          style={{ overflow: scrollEnabled ? 'auto' : 'hidden' }}\n        >\n          <TheatreElements sheet={sheet} />\n          <ScrollHeight />\n        </TheatreContainer>\n      </ViewBox>\n      <PositionFinisher ref={finisherRef} id='finisher' />\n\n      <Other />\n    </>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}