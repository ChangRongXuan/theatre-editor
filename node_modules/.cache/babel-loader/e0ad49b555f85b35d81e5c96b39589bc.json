{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import studio from'@theatre/studio';import{val,getProject}from'@theatre/core';import{useState,useEffect,useRef}from'react';import styled from'styled-components';import Stage from'../components/stage';import Dimmer from'../components/dimmer-with-message';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ScrollSizer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  position: relative;\\n  width: 100vw;\\n  min-width: 100vw;\\n  max-width: 100vw;\\n  min-height: 100vh;\\n  background: #ffffff;\\n\"])));var StickyBox=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n  position: sticky;\\n  top: 0;\\n  left: 0;\\n\"])));var defaultScrollScale=1500;export default function DemoScroll(){studio.initialize();studio.ui.hide();var project=getProject('Project',{});var sheet=project.sheet('Scene','default');project.ready.then(function(){return sheet.sequence.pause();});// --------------------------\nvar objJson=localStorage.getItem('theatre-data');// get objectJSON in local-storage\nvar objData=objJson?JSON.parse(objJson):[];// --------------------------\n// TODO: 增加條件，減少 event-listener 偵測時間\nvar _useState=useState(0),_useState2=_slicedToArray(_useState,2),scrollPosition=_useState2[0],setScrollPosition=_useState2[1];var sequenceLength=val(sheet.sequence.pointer.length);var stageRef=useRef(null);useEffect(function(){var handleScroll=function handleScroll(){var stage=stageRef.current;var sizer=stage.closest('.theatre-scroll-sizer');var stageRect=stage.getBoundingClientRect();var sizerRect=sizer.getBoundingClientRect();var distance=stageRect.top-sizerRect.top;setScrollPosition(distance);};window.addEventListener('scroll',handleScroll);return function(){window.removeEventListener('scroll',handleScroll);};},[]);useEffect(function(){var newPosition=scrollPosition/(sequenceLength*defaultScrollScale)*sequenceLength;sheet.sequence.position=newPosition;},[scrollPosition]);// ----------------------------\nvar _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),hasImgError=_useState4[0],setHasImgError=_useState4[1];// image & background onError\nvar _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),loadedImages=_useState6[0],setLoadedImages=_useState6[1];// image & background onload\nvar _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),isLoading=_useState8[0],setIsLoading=_useState8[1];var totalImages=objData.filter(function(data){return data.type==='IMAGE'||data.type==='BACKGROUND';}).length;useEffect(function(){if(loadedImages===totalImages){setIsLoading(false);}},[loadedImages,totalImages]);var sizerHeight=hasImgError||isLoading?'100vh':\"\".concat(sequenceLength*defaultScrollScale,\"px\");return/*#__PURE__*/_jsx(ScrollSizer,{className:\"theatre-scroll-sizer\",style:{height:sizerHeight},children:/*#__PURE__*/_jsxs(StickyBox,{ref:stageRef,children:[/*#__PURE__*/_jsx(Dimmer,{show:isLoading&&!hasImgError,message:'載入中',shining:true}),/*#__PURE__*/_jsx(Dimmer,{show:hasImgError,message:'載入失敗。請檢查您的網路連線，並重新整理瀏覽器。'}),/*#__PURE__*/_jsx(Stage,{objData:objData,sheet:sheet,stageWidth:window.innerWidth,draggable:false,setHasImgError:setHasImgError,setLoadedImages:setLoadedImages})]})});}","map":{"version":3,"names":["studio","val","getProject","useState","useEffect","useRef","styled","Stage","Dimmer","jsx","_jsx","jsxs","_jsxs","ScrollSizer","div","_templateObject","_taggedTemplateLiteral","StickyBox","_templateObject2","defaultScrollScale","DemoScroll","initialize","ui","hide","project","sheet","ready","then","sequence","pause","objJson","localStorage","getItem","objData","JSON","parse","_useState","_useState2","_slicedToArray","scrollPosition","setScrollPosition","sequenceLength","pointer","length","stageRef","handleScroll","stage","current","sizer","closest","stageRect","getBoundingClientRect","sizerRect","distance","top","window","addEventListener","removeEventListener","newPosition","position","_useState3","_useState4","hasImgError","setHasImgError","_useState5","_useState6","loadedImages","setLoadedImages","_useState7","_useState8","isLoading","setIsLoading","totalImages","filter","data","type","sizerHeight","concat","className","style","height","children","ref","show","message","shining","stageWidth","innerWidth","draggable"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\nimport Dimmer from '../components/dimmer-with-message';\n\nconst ScrollSizer = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  background: #ffffff;\n`;\n\nconst StickyBox = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n\nconst defaultScrollScale = 1500;\n\nexport default function DemoScroll() {\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n\n  const objJson = localStorage.getItem('theatre-data'); // get objectJSON in local-storage\n  const objData = objJson ? JSON.parse(objJson) : [];\n\n  // --------------------------\n\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  const sequenceLength = val(sheet.sequence.pointer.length);\n  const stageRef = useRef(null);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const sizer = stage.closest('.theatre-scroll-sizer');\n\n      const stageRect = stage.getBoundingClientRect();\n      const sizerRect = sizer.getBoundingClientRect();\n\n      const distance = stageRect.top - sizerRect.top;\n      setScrollPosition(distance);\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    const newPosition =\n      (scrollPosition / (sequenceLength * defaultScrollScale)) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  // ----------------------------\n\n  const [hasImgError, setHasImgError] = useState(false); // image & background onError\n  const [loadedImages, setLoadedImages] = useState(0); // image & background onload\n  const [isLoading, setIsLoading] = useState(true);\n\n  const totalImages = objData.filter(\n    (data) => data.type === 'IMAGE' || data.type === 'BACKGROUND'\n  ).length;\n\n  useEffect(() => {\n    if (loadedImages === totalImages) {\n      setIsLoading(false);\n    }\n  }, [loadedImages, totalImages]);\n\n  const sizerHeight =\n    hasImgError || isLoading\n      ? '100vh'\n      : `${sequenceLength * defaultScrollScale}px`;\n\n  return (\n    <ScrollSizer\n      className='theatre-scroll-sizer'\n      style={{ height: sizerHeight }}\n    >\n      <StickyBox ref={stageRef}>\n        <Dimmer\n          show={isLoading && !hasImgError}\n          message={'載入中'}\n          shining={true}\n        />\n        <Dimmer\n          show={hasImgError}\n          message={'載入失敗。請檢查您的網路連線，並重新整理瀏覽器。'}\n        />\n        <Stage\n          objData={objData}\n          sheet={sheet}\n          stageWidth={window.innerWidth}\n          draggable={false}\n          setHasImgError={setHasImgError}\n          setLoadedImages={setLoadedImages}\n        />\n      </StickyBox>\n    </ScrollSizer>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}