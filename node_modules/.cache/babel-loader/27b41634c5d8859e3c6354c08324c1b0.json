{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6;import studio from'@theatre/studio';import{getProject,val}from'@theatre/core';import{useState,useEffect,useRef}from'react';import styled from'styled-components';import TheatreElements from'../components/theatre-elements';import{useInView}from'react-intersection-observer';// import { getProject, types } from '@theatre/core';\nimport projectState from'../data/state.json';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var defaultViewportHeight='100vh';var ViewBox=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  position: relative;\\n  width: 100%;\\n  height: 3000px;\\n  min-height: 100vh;\\n  outline: 3px solid blue;\\n\"])));var TheatreContainer=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n  outline: 1px solid red;\\n\\n  position: sticky;\\n  top: 0;\\n  left: 0;\\n\"])));// 下面參考 scrollable-video ---------------------------------\n//代表滑到這個框框的最上方\nvar PositionStarter=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  width: 0;\\n  height: 0;\\n  opacity: 0;\\n\"])));var PositionFinisher=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  width: 0;\\n  height: 0;\\n  opacity: 0;\\n\"])));var Other=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n\"])));var Test=styled.div(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  width: 25px;\\n  height: 25px;\\n  outline: 1px solid red;\\n  position: sticky;\\n  top: 0;\\n  left: 0;\\n  background: red;\\n\"])));export default function DemoScroll(_ref){var project=_ref.project,sheet=_ref.sheet;// studio.initialize();\n// const project = getProject('deepfake demo', { state: projectState });\n// const sheet = project.sheet('Scene', 'default');\nstudio.ui.hide();project.ready.then(function(){return sheet.sequence.pause;});var sequenceLength=val(sheet.sequence.pointer.length);// --------------------------------------------------------\nvar testRef=useRef(null);var _useState=useState(0),_useState2=_slicedToArray(_useState,2),scrollPosition=_useState2[0],setScrollPosition=_useState2[1];console.log('scrollPosition',scrollPosition);// TODO: 增加條件，減少 event-listener 偵測時間\nuseEffect(function(){var handleScroll=function handleScroll(){var testElement=testRef.current;var viewboxElement=testElement.closest('.ViewBox');var testRect=testElement.getBoundingClientRect();var viewboxRect=viewboxElement.getBoundingClientRect();var distance=testRect.top-viewboxRect.top;setScrollPosition(distance);};window.addEventListener('scroll',handleScroll);return function(){window.removeEventListener('scroll',handleScroll);};},[]);useEffect(function(){// 3000 等同於 ScrollHeight 元件的高度\nvar newPosition=scrollPosition/3000*sequenceLength;sheet.sequence.position=newPosition;},[scrollPosition]);// ----- 上面這段是絕對可用的，勿動 --------------------------------\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Other,{}),/*#__PURE__*/_jsx(ViewBox,{className:\"ViewBox\",children:/*#__PURE__*/_jsx(TheatreContainer,{id:\"theatre-container\",ref:testRef,children:/*#__PURE__*/_jsx(TheatreElements,{sheet:sheet})})}),/*#__PURE__*/_jsx(Other,{})]});}","map":{"version":3,"names":["studio","getProject","val","useState","useEffect","useRef","styled","TheatreElements","useInView","projectState","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","defaultViewportHeight","ViewBox","div","_templateObject","_taggedTemplateLiteral","TheatreContainer","_templateObject2","PositionStarter","_templateObject3","PositionFinisher","_templateObject4","Other","_templateObject5","Test","_templateObject6","DemoScroll","_ref","project","sheet","ui","hide","ready","then","sequence","pause","sequenceLength","pointer","length","testRef","_useState","_useState2","_slicedToArray","scrollPosition","setScrollPosition","console","log","handleScroll","testElement","current","viewboxElement","closest","testRect","getBoundingClientRect","viewboxRect","distance","top","window","addEventListener","removeEventListener","newPosition","position","children","className","id","ref"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { getProject, val } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport TheatreElements from '../components/theatre-elements';\nimport { useInView } from 'react-intersection-observer';\n\n// import { getProject, types } from '@theatre/core';\nimport projectState from '../data/state.json';\n\nconst defaultViewportHeight = '100vh';\n\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100%;\n  height: 3000px;\n  min-height: 100vh;\n  outline: 3px solid blue;\n`;\n\nconst TheatreContainer = styled.div`\n  width: 100%;\n  height: 100vh;\n  outline: 1px solid red;\n\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n\n// 下面參考 scrollable-video ---------------------------------\n\n//代表滑到這個框框的最上方\nconst PositionStarter = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n\nconst PositionFinisher = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n\nconst Other = styled.div`\n  width: 100%;\n  height: 100vh;\n`;\n\nconst Test = styled.div`\n  width: 25px;\n  height: 25px;\n  outline: 1px solid red;\n  position: sticky;\n  top: 0;\n  left: 0;\n  background: red;\n`;\n\nexport default function DemoScroll({ project, sheet }) {\n  // studio.initialize();\n  // const project = getProject('deepfake demo', { state: projectState });\n  // const sheet = project.sheet('Scene', 'default');\n\n  studio.ui.hide();\n  project.ready.then(() => sheet.sequence.pause);\n\n  const sequenceLength = val(sheet.sequence.pointer.length);\n\n  // --------------------------------------------------------\n\n  const testRef = useRef(null);\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  console.log('scrollPosition', scrollPosition);\n\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const testElement = testRef.current;\n      const viewboxElement = testElement.closest('.ViewBox');\n\n      const testRect = testElement.getBoundingClientRect();\n      const viewboxRect = viewboxElement.getBoundingClientRect();\n\n      const distance = testRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    // 3000 等同於 ScrollHeight 元件的高度\n    const newPosition = (scrollPosition / 3000) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  // ----- 上面這段是絕對可用的，勿動 --------------------------------\n\n  return (\n    <>\n      <Other />\n\n      <ViewBox className='ViewBox'>\n        <TheatreContainer id='theatre-container' ref={testRef}>\n          <TheatreElements sheet={sheet} />\n        </TheatreContainer>\n      </ViewBox>\n\n      <Other />\n    </>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}