{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/GitHub/deepfake-demo/src/page/scroll.js\",\n  _s = $RefreshSig$();\nimport studio from '@theatre/studio';\nimport { getProject, val } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport TheatreElements from '../components/theatre-elements';\n\n// import { getProject, types } from '@theatre/core';\nimport projectState from '../json/state.json';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst defaultViewportHeight = '100vh';\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100vh;\n  overflow: hidden;\n  outline: 5px solid red;\n`;\n_c = ViewBox;\nconst TheatreContainer = styled.div`\n  width: 100%;\n  height: 100%;\n  outline: 5px solid red;\n  overflow-y: auto;\n  padding-right: 15px; //to hide scroll-bar\n`;\n_c2 = TheatreContainer;\nconst ScrollHeight = styled.div`\n  background: pink;\n  width: 100%;\n  height: 200vh;\n`;\n\n// 下面參考 scrollable-video ---------------------------------\n\n//代表滑到這個框框的最上方\n_c3 = ScrollHeight;\nconst PositionStarter = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n\n// 對位用，對齊左上角\n// const Box100vh = styled.div`\n//   width: 0;\n//   position: fixed;\n//   height: ${defaultViewportHeight};\n//   left: 0;\n//   top: 0;\n//   background: black;\n//   z-index: 100000;\n//   /* opacity: 0; */\n// `;\n_c4 = PositionStarter;\nconst Other = styled.div`\n  width: 100%;\n  height: 100vh;\n`;\n_c5 = Other;\nexport default function ScrollDemo() {\n  _s();\n  studio.initialize();\n  const project = getProject('deepfake demo', {\n    state: projectState\n  });\n  const sheet = project.sheet('Scene', 'default');\n  studio.ui.hide();\n  project.ready.then(() => sheet.sequence.pause);\n  const containerRef = useRef(null);\n  const positionStarterRef = useRef(null);\n  const positionEndRef = useRef(null);\n\n  //滑動的離頂端有多少距離\n  const [scrollPosition, setScrollPosition] = useState(0);\n  useEffect(() => {\n    const container = containerRef.current;\n    const handleScroll = () => {\n      const currentPosition = container.scrollTop;\n      setScrollPosition(currentPosition);\n    };\n    container.addEventListener('scroll', handleScroll);\n    return () => {\n      container.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n  const sequenceLength = val(sheet.sequence.pointer.length);\n  // 透過 scrollPosition 去決定 sequence 的位置\n  useEffect(() => {\n    const newPosition = scrollPosition / 2000 * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n  const [scrollEnabled, setScrollEnabled] = useState(false);\n  console.log('scrollEnabled', scrollEnabled);\n  useEffect(() => {\n    const positionStarter = positionStarterRef.current;\n    const positionEnd = positionEndRef.current;\n\n    // const handleScrollEnable = () => {\n    //   const positionStarterRect = positionStarter.getBoundingClientRect();\n\n    //   console.log('positionStarterRect.top', positionStarterRect.top);\n    //   console.log('positionStarterRect.left', positionStarterRect.left);\n\n    //   console.log(\n    //     ' positionStarterRect.top === 0 && positionStarterRect.left === 0',\n    //     positionStarterRect.top <= 0 && positionStarterRect.left <= 0\n    //   );\n\n    //   setScrollEnabled(\n    //     positionStarterRect.top === 0 && positionStarterRect.left === 0\n    //   );\n    // };\n\n    const handleScrollEnable = () => {\n      const positionStarterRect = positionStarter.getBoundingClientRect();\n      const isAtTop = positionStarterRect.top <= 0;\n      const isAtBottom = window.innerHeight + containerRef.current.scrollTop >= containerRef.current.scrollHeight;\n      console.log('isAtTop', isAtTop);\n      console.log('isAtBottom', isAtBottom);\n      setScrollEnabled(isAtTop && !isAtBottom);\n    };\n    handleScrollEnable(); // Check initial visibility\n    window.addEventListener('scroll', handleScrollEnable);\n    return () => {\n      window.removeEventListener('scroll', handleScrollEnable);\n    };\n  }, []);\n  useEffect(() => {\n    document.body.style.overflow = scrollEnabled ? 'hidden' : 'auto';\n    return () => {\n      document.body.style.overflow = 'auto';\n    };\n  }, [scrollEnabled]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Other, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PositionStarter, {\n      ref: positionStarterRef,\n      id: \"starter\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ViewBox, {\n      children: /*#__PURE__*/_jsxDEV(TheatreContainer, {\n        id: \"item-container\",\n        ref: containerRef,\n        style: {\n          overflow: scrollEnabled ? 'auto' : 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(TheatreElements, {\n          sheet: sheet\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(ScrollHeight, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(PositionEnd, {\n          ref: positionEndRef,\n          id: \"end\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Other, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(ScrollDemo, \"QwtJ+Xhat81Y3NSuvk0yXWlZCXE=\");\n_c6 = ScrollDemo;\nvar _c, _c2, _c3, _c4, _c5, _c6;\n$RefreshReg$(_c, \"ViewBox\");\n$RefreshReg$(_c2, \"TheatreContainer\");\n$RefreshReg$(_c3, \"ScrollHeight\");\n$RefreshReg$(_c4, \"PositionStarter\");\n$RefreshReg$(_c5, \"Other\");\n$RefreshReg$(_c6, \"ScrollDemo\");","map":{"version":3,"names":["studio","getProject","val","useState","useEffect","useRef","styled","TheatreElements","projectState","jsxDEV","_jsxDEV","Fragment","_Fragment","defaultViewportHeight","ViewBox","div","_c","TheatreContainer","_c2","ScrollHeight","_c3","PositionStarter","_c4","Other","_c5","ScrollDemo","_s","initialize","project","state","sheet","ui","hide","ready","then","sequence","pause","containerRef","positionStarterRef","positionEndRef","scrollPosition","setScrollPosition","container","current","handleScroll","currentPosition","scrollTop","addEventListener","removeEventListener","sequenceLength","pointer","length","newPosition","position","scrollEnabled","setScrollEnabled","console","log","positionStarter","positionEnd","handleScrollEnable","positionStarterRect","getBoundingClientRect","isAtTop","top","isAtBottom","window","innerHeight","scrollHeight","document","body","style","overflow","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","id","PositionEnd","_c6","$RefreshReg$"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { getProject, val } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport TheatreElements from '../components/theatre-elements';\n\n// import { getProject, types } from '@theatre/core';\nimport projectState from '../json/state.json';\n\nconst defaultViewportHeight = '100vh';\n\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100vh;\n  overflow: hidden;\n  outline: 5px solid red;\n`;\n\nconst TheatreContainer = styled.div`\n  width: 100%;\n  height: 100%;\n  outline: 5px solid red;\n  overflow-y: auto;\n  padding-right: 15px; //to hide scroll-bar\n`;\n\nconst ScrollHeight = styled.div`\n  background: pink;\n  width: 100%;\n  height: 200vh;\n`;\n\n// 下面參考 scrollable-video ---------------------------------\n\n//代表滑到這個框框的最上方\nconst PositionStarter = styled.div`\n  width: 0;\n  height: 0;\n  opacity: 0;\n`;\n\n// 對位用，對齊左上角\n// const Box100vh = styled.div`\n//   width: 0;\n//   position: fixed;\n//   height: ${defaultViewportHeight};\n//   left: 0;\n//   top: 0;\n//   background: black;\n//   z-index: 100000;\n//   /* opacity: 0; */\n// `;\n\nconst Other = styled.div`\n  width: 100%;\n  height: 100vh;\n`;\n\nexport default function ScrollDemo() {\n  studio.initialize();\n  const project = getProject('deepfake demo', { state: projectState });\n  const sheet = project.sheet('Scene', 'default');\n\n  studio.ui.hide();\n  project.ready.then(() => sheet.sequence.pause);\n\n  const containerRef = useRef(null);\n  const positionStarterRef = useRef(null);\n  const positionEndRef = useRef(null);\n\n  //滑動的離頂端有多少距離\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    const handleScroll = () => {\n      const currentPosition = container.scrollTop;\n      setScrollPosition(currentPosition);\n    };\n\n    container.addEventListener('scroll', handleScroll);\n\n    return () => {\n      container.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  const sequenceLength = val(sheet.sequence.pointer.length);\n  // 透過 scrollPosition 去決定 sequence 的位置\n  useEffect(() => {\n    const newPosition = (scrollPosition / 2000) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  const [scrollEnabled, setScrollEnabled] = useState(false);\n\n  console.log('scrollEnabled', scrollEnabled);\n\n  useEffect(() => {\n    const positionStarter = positionStarterRef.current;\n    const positionEnd = positionEndRef.current;\n\n    // const handleScrollEnable = () => {\n    //   const positionStarterRect = positionStarter.getBoundingClientRect();\n\n    //   console.log('positionStarterRect.top', positionStarterRect.top);\n    //   console.log('positionStarterRect.left', positionStarterRect.left);\n\n    //   console.log(\n    //     ' positionStarterRect.top === 0 && positionStarterRect.left === 0',\n    //     positionStarterRect.top <= 0 && positionStarterRect.left <= 0\n    //   );\n\n    //   setScrollEnabled(\n    //     positionStarterRect.top === 0 && positionStarterRect.left === 0\n    //   );\n    // };\n\n    const handleScrollEnable = () => {\n      const positionStarterRect = positionStarter.getBoundingClientRect();\n\n      const isAtTop = positionStarterRect.top <= 0;\n      const isAtBottom =\n        window.innerHeight + containerRef.current.scrollTop >=\n        containerRef.current.scrollHeight;\n\n      console.log('isAtTop', isAtTop);\n\n      console.log('isAtBottom', isAtBottom);\n\n      setScrollEnabled(isAtTop && !isAtBottom);\n    };\n\n    handleScrollEnable(); // Check initial visibility\n    window.addEventListener('scroll', handleScrollEnable);\n\n    return () => {\n      window.removeEventListener('scroll', handleScrollEnable);\n    };\n  }, []);\n\n  useEffect(() => {\n    document.body.style.overflow = scrollEnabled ? 'hidden' : 'auto';\n\n    return () => {\n      document.body.style.overflow = 'auto';\n    };\n  }, [scrollEnabled]);\n\n  return (\n    <>\n      <Other />\n      <PositionStarter ref={positionStarterRef} id='starter' />\n      <ViewBox>\n        <TheatreContainer\n          id='item-container'\n          ref={containerRef}\n          style={{ overflow: scrollEnabled ? 'auto' : 'hidden' }}\n        >\n          <TheatreElements sheet={sheet} />\n          <ScrollHeight />\n          <PositionEnd ref={positionEndRef} id='end' />\n        </TheatreContainer>\n      </ViewBox>\n\n      <Other />\n    </>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}