{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js\",\n  _s = $RefreshSig$();\nimport studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\nimport { renderFontObject, renderImageObject } from '../utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  overflow: hidden;\n`;\n_c = ViewBox;\nconst StageWrapper = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n_c2 = StageWrapper;\nconst defaultScrollScale = 1500;\nexport default function DemoScroll() {\n  _s();\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n  const sequenceLength = val(sheet.sequence.pointer.length); //總長度\n  const stageRef = useRef(null);\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const viewbox = stage.closest('.theatre-scroll-viewbox');\n      const stageRect = stage.getBoundingClientRect();\n      const viewboxRect = viewbox.getBoundingClientRect();\n      const distance = stageRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n  useEffect(() => {\n    const newPosition = scrollPosition / (sequenceLength * defaultScrollScale) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  // ------------------------------\n\n  const [storedData, setStoredData] = useState([]); // get data in local-storage\n\n  useEffect(() => {\n    const elements = localStorage.getItem('theatre-data');\n    if (elements) {\n      setStoredData(JSON.parse(elements));\n    }\n  }, []);\n  useEffect(() => {\n    if (storedData.length > 0) {\n      renderFontObject(storedData, sheet);\n      renderImageObject(storedData, sheet);\n    }\n  }, [storedData]);\n  return /*#__PURE__*/_jsxDEV(ViewBox, {\n    className: \"theatre-scroll-viewbox\",\n    style: {\n      height: `${sequenceLength * defaultScrollScale}px`\n    },\n    children: /*#__PURE__*/_jsxDEV(StageWrapper, {\n      ref: stageRef,\n      children: /*#__PURE__*/_jsxDEV(Stage, {\n        storedData: storedData\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 5\n  }, this);\n}\n_s(DemoScroll, \"a910xs12galh9JCfyYkt6JMiSKk=\");\n_c3 = DemoScroll;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"ViewBox\");\n$RefreshReg$(_c2, \"StageWrapper\");\n$RefreshReg$(_c3, \"DemoScroll\");","map":{"version":3,"names":["studio","val","getProject","useState","useEffect","useRef","styled","Stage","renderFontObject","renderImageObject","jsxDEV","_jsxDEV","ViewBox","div","_c","StageWrapper","_c2","defaultScrollScale","DemoScroll","_s","initialize","ui","hide","project","sheet","ready","then","sequence","pause","scrollPosition","setScrollPosition","sequenceLength","pointer","length","stageRef","handleScroll","stage","current","viewbox","closest","stageRect","getBoundingClientRect","viewboxRect","distance","top","window","addEventListener","removeEventListener","newPosition","position","storedData","setStoredData","elements","localStorage","getItem","JSON","parse","className","style","height","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c3","$RefreshReg$"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\nimport { renderFontObject, renderImageObject } from '../utils';\n\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  overflow: hidden;\n`;\n\nconst StageWrapper = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n\nconst defaultScrollScale = 1500;\n\nexport default function DemoScroll() {\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  const sequenceLength = val(sheet.sequence.pointer.length); //總長度\n  const stageRef = useRef(null);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const viewbox = stage.closest('.theatre-scroll-viewbox');\n\n      const stageRect = stage.getBoundingClientRect();\n      const viewboxRect = viewbox.getBoundingClientRect();\n\n      const distance = stageRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    const newPosition =\n      (scrollPosition / (sequenceLength * defaultScrollScale)) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  // ------------------------------\n\n  const [storedData, setStoredData] = useState([]); // get data in local-storage\n\n  useEffect(() => {\n    const elements = localStorage.getItem('theatre-data');\n    if (elements) {\n      setStoredData(JSON.parse(elements));\n    }\n  }, []);\n\n  useEffect(() => {\n    if (storedData.length > 0) {\n      renderFontObject(storedData, sheet);\n      renderImageObject(storedData, sheet);\n    }\n  }, [storedData]);\n\n  return (\n    <ViewBox\n      className='theatre-scroll-viewbox'\n      style={{ height: `${sequenceLength * defaultScrollScale}px` }}\n    >\n      <StageWrapper ref={stageRef}>\n        <Stage storedData={storedData} />\n      </StageWrapper>\n    </ViewBox>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}