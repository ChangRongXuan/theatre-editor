{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import studio from'@theatre/studio';import{val,getProject}from'@theatre/core';import{useState,useEffect,useRef}from'react';import styled from'styled-components';import Stage from'../components/stage';import{jsx as _jsx}from\"react/jsx-runtime\";var ViewBox=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  position: relative;\\n  width: 100vw;\\n  min-width: 100vw;\\n  max-width: 100vw;\\n  min-height: 100vh;\\n  background: #ffffff;\\n\"])));var StageWrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n  position: sticky;\\n  top: 0;\\n  left: 0;\\n\"])));var defaultScrollScale=1500;export default function DemoScroll(){studio.initialize();studio.ui.hide();var project=getProject('Project',{});var sheet=project.sheet('Scene','default');project.ready.then(function(){return sheet.sequence.pause();});// --------------------------\n// TODO: 增加條件，減少 event-listener 偵測時間\nvar _useState=useState(0),_useState2=_slicedToArray(_useState,2),scrollPosition=_useState2[0],setScrollPosition=_useState2[1];var sequenceLength=val(sheet.sequence.pointer.length);//播放總時間長度\nvar stageRef=useRef(null);useEffect(function(){var handleScroll=function handleScroll(){var stage=stageRef.current;var viewbox=stage.closest('.theatre-scroll-viewbox');var stageRect=stage.getBoundingClientRect();var viewboxRect=viewbox.getBoundingClientRect();var distance=stageRect.top-viewboxRect.top;setScrollPosition(distance);};window.addEventListener('scroll',handleScroll);return function(){window.removeEventListener('scroll',handleScroll);};},[]);useEffect(function(){var newPosition=scrollPosition/(sequenceLength*defaultScrollScale)*sequenceLength;sheet.sequence.position=newPosition;},[scrollPosition]);var objJson=localStorage.getItem('theatre-data');// get objectJSON in local-storage\nvar objData=objJson?JSON.parse(objJson):[];var screenWidth=window.innerWidth;return/*#__PURE__*/_jsx(ViewBox,{className:\"theatre-scroll-viewbox\",style:{height:\"\".concat(sequenceLength*defaultScrollScale,\"px\")},children:/*#__PURE__*/_jsx(StageWrapper,{ref:stageRef,children:/*#__PURE__*/_jsx(Stage,{objData:objData,sheet:sheet,stageWidth:screenWidth,draggable:false})})});}","map":{"version":3,"names":["studio","val","getProject","useState","useEffect","useRef","styled","Stage","jsx","_jsx","ViewBox","div","_templateObject","_taggedTemplateLiteral","StageWrapper","_templateObject2","defaultScrollScale","DemoScroll","initialize","ui","hide","project","sheet","ready","then","sequence","pause","_useState","_useState2","_slicedToArray","scrollPosition","setScrollPosition","sequenceLength","pointer","length","stageRef","handleScroll","stage","current","viewbox","closest","stageRect","getBoundingClientRect","viewboxRect","distance","top","window","addEventListener","removeEventListener","newPosition","position","objJson","localStorage","getItem","objData","JSON","parse","screenWidth","innerWidth","className","style","height","concat","children","ref","stageWidth","draggable"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\n\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  background: #ffffff;\n`;\n\nconst StageWrapper = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n\nconst defaultScrollScale = 1500;\n\nexport default function DemoScroll() {\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  const sequenceLength = val(sheet.sequence.pointer.length); //播放總時間長度\n  const stageRef = useRef(null);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const viewbox = stage.closest('.theatre-scroll-viewbox');\n\n      const stageRect = stage.getBoundingClientRect();\n      const viewboxRect = viewbox.getBoundingClientRect();\n\n      const distance = stageRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    const newPosition =\n      (scrollPosition / (sequenceLength * defaultScrollScale)) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  const objJson = localStorage.getItem('theatre-data'); // get objectJSON in local-storage\n  const objData = objJson ? JSON.parse(objJson) : [];\n\n  const screenWidth = window.innerWidth;\n\n  return (\n    <ViewBox\n      className='theatre-scroll-viewbox'\n      style={{ height: `${sequenceLength * defaultScrollScale}px` }}\n    >\n      <StageWrapper ref={stageRef}>\n        <Stage\n          objData={objData}\n          sheet={sheet}\n          stageWidth={screenWidth}\n          draggable={false}\n        />\n      </StageWrapper>\n    </ViewBox>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}