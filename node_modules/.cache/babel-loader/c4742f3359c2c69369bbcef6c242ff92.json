{"ast":null,"code":"import _slicedToArray from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/mac/Documents/GitHub/deepfake-demo/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import studio from'@theatre/studio';import{getProject,types}from'@theatre/core';import{useState,useEffect}from'react';import styled from'styled-components';import projectState from'../json/state.json';import{val}from'@theatre/core';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n  position: relative;\\n  outline: 5px solid red;\\n  z-index: -1;\\n  overflow: hidden;\\n\"])));var BasicBox=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  width: 300px;\\n  height: 20px;\\n  background: white;\\n  outline: 3px solid black;\\n  z-index: 10000;\\n  padding: 20px;\\n\"])));export default function ScrollDemo(){studio.initialize();var project=getProject('deepfake demo',{state:projectState});var sheet=project.sheet('Scene','default');// studio.ui.restore();\n// project.ready.then(() =>\n//   sheet.sequence.play({\n//     iterationCount: 1,\n//   })\n// );\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),preData=_useState2[0],setPreData=_useState2[1];//上一筆舊資料，要與 local-storage 一致\nvar scrollOffset=useScrollOffset();// 自訂的 hook，用於獲取滾動位置\n//從 local-storage 取得舊資料\nuseEffect(function(){var storedBoxes=localStorage.getItem('theatre-data');if(storedBoxes){setPreData(JSON.parse(storedBoxes));}},[]);//render 出既有的元件\nuseEffect(function(){preData.filter(function(item){return item.type==='box';}).forEach(function(item){var box=sheet.object(item.id,{position:{x:0,y:0},bgColor:types.string('#ffffff')});var element=document.getElementById(item.id);box.onValuesChange(function(newValue){element.style.left=newValue.position.x+'px';element.style.top=newValue.position.y+'px';element.style.backgroundColor=newValue.bgColor;});});},[]);var totalSeconds=val(sheet.sequence.pointer.length);console.log('totalSeconds',totalSeconds);console.log('scrollOffset * totalSeconds',scrollOffset*totalSeconds);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Container,{id:\"item-container\",children:preData.map(function(box,index){return/*#__PURE__*/_jsx(BasicBox,{id:box.id,style:box.style,children:box.content},index);})})});}// 自訂的 hook，用於獲取滾動位置\nfunction useScrollOffset(){var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),scrollOffset=_useState4[0],setScrollOffset=_useState4[1];useEffect(function(){function handleScroll(){var _document$documentEle=document.documentElement,scrollTop=_document$documentEle.scrollTop,scrollHeight=_document$documentEle.scrollHeight,clientHeight=_document$documentEle.clientHeight;var maxScrollOffset=scrollHeight-clientHeight;var currentScrollOffset=scrollTop/maxScrollOffset;setScrollOffset(currentScrollOffset);}window.addEventListener('scroll',handleScroll);return function(){window.removeEventListener('scroll',handleScroll);};},[]);return scrollOffset;}","map":{"version":3,"names":["studio","getProject","types","useState","useEffect","styled","projectState","val","jsx","_jsx","Fragment","_Fragment","Container","div","_templateObject","_taggedTemplateLiteral","BasicBox","_templateObject2","ScrollDemo","initialize","project","state","sheet","_useState","_useState2","_slicedToArray","preData","setPreData","scrollOffset","useScrollOffset","storedBoxes","localStorage","getItem","JSON","parse","filter","item","type","forEach","box","object","id","position","x","y","bgColor","string","element","document","getElementById","onValuesChange","newValue","style","left","top","backgroundColor","totalSeconds","sequence","pointer","length","console","log","children","map","index","content","_useState3","_useState4","setScrollOffset","handleScroll","_document$documentEle","documentElement","scrollTop","scrollHeight","clientHeight","maxScrollOffset","currentScrollOffset","window","addEventListener","removeEventListener"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/scroll-demo.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { getProject, types } from '@theatre/core';\nimport { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport projectState from '../json/state.json';\nimport { val } from '@theatre/core';\n\nconst Container = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: relative;\n  outline: 5px solid red;\n  z-index: -1;\n  overflow: hidden;\n`;\n\nconst BasicBox = styled.div`\n  position: absolute;\n  width: 300px;\n  height: 20px;\n  background: white;\n  outline: 3px solid black;\n  z-index: 10000;\n  padding: 20px;\n`;\n\nexport default function ScrollDemo() {\n  studio.initialize();\n\n  const project = getProject('deepfake demo', { state: projectState });\n  const sheet = project.sheet('Scene', 'default');\n\n  // studio.ui.restore();\n\n  // project.ready.then(() =>\n  //   sheet.sequence.play({\n  //     iterationCount: 1,\n  //   })\n  // );\n\n  const [preData, setPreData] = useState([]); //上一筆舊資料，要與 local-storage 一致\n\n  const scrollOffset = useScrollOffset(); // 自訂的 hook，用於獲取滾動位置\n\n  //從 local-storage 取得舊資料\n  useEffect(() => {\n    const storedBoxes = localStorage.getItem('theatre-data');\n    if (storedBoxes) {\n      setPreData(JSON.parse(storedBoxes));\n    }\n  }, []);\n\n  //render 出既有的元件\n  useEffect(() => {\n    preData\n      .filter((item) => item.type === 'box')\n      .forEach((item) => {\n        const box = sheet.object(item.id, {\n          position: {\n            x: 0,\n            y: 0,\n          },\n          bgColor: types.string('#ffffff'),\n        });\n\n        const element = document.getElementById(item.id);\n\n        box.onValuesChange((newValue) => {\n          element.style.left = newValue.position.x + 'px';\n          element.style.top = newValue.position.y + 'px';\n          element.style.backgroundColor = newValue.bgColor;\n        });\n      });\n  }, []);\n\n  const totalSeconds = val(sheet.sequence.pointer.length);\n  console.log('totalSeconds', totalSeconds);\n\n  console.log('scrollOffset * totalSeconds', scrollOffset * totalSeconds);\n\n  return (\n    <>\n      <Container id='item-container'>\n        {preData.map((box, index) => (\n          <BasicBox key={index} id={box.id} style={box.style}>\n            {box.content}\n          </BasicBox>\n        ))}\n      </Container>\n    </>\n  );\n}\n\n// 自訂的 hook，用於獲取滾動位置\nfunction useScrollOffset() {\n  const [scrollOffset, setScrollOffset] = useState(0);\n\n  useEffect(() => {\n    function handleScroll() {\n      const { scrollTop, scrollHeight, clientHeight } =\n        document.documentElement;\n      const maxScrollOffset = scrollHeight - clientHeight;\n      const currentScrollOffset = scrollTop / maxScrollOffset;\n      setScrollOffset(currentScrollOffset);\n    }\n\n    window.addEventListener('scroll', handleScroll);\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  return scrollOffset;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}