{"ast":null,"code":"var _jsxFileName = \"/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js\",\n  _s = $RefreshSig$();\nimport studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\nimport Dimmer from '../components/dimmer-with-message';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  background: #ffffff;\n`;\n_c = ViewBox;\nconst StageWrapper = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n_c2 = StageWrapper;\nfunction Spinner() {\n  return /*#__PURE__*/_jsxDEV(SpinnerBlock, {\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      viewBox: \"0 0 20 20\",\n      version: \"1.1\",\n      xmlns: \"http://www.w3.org/2000/svg\",\n      xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n      children: /*#__PURE__*/_jsxDEV(\"g\", {\n        stroke: \"none\",\n        strokeWidth: \"1\",\n        fill: \"none\",\n        fillRule: \"evenodd\",\n        children: /*#__PURE__*/_jsxDEV(\"g\", {\n          fill: \"#fff\",\n          fillRule: \"nonzero\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M10,3.5 C6.41015,3.5 3.5,6.41015 3.5,10 C3.5,10.4142 3.16421,10.75 2.75,10.75 C2.33579,10.75 2,10.4142 2,10 C2,5.58172 5.58172,2 10,2 C14.4183,2 18,5.58172 18,10 C18,14.4183 14.4183,18 10,18 C9.58579,18 9.25,17.6642 9.25,17.25 C9.25,16.8358 9.58579,16.5 10,16.5 C13.5899,16.5 16.5,13.5899 16.5,10 C16.5,6.41015 13.5899,3.5 10,3.5 Z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 36,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 35,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 28,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 27,\n    columnNumber: 5\n  }, this);\n}\n_c3 = Spinner;\nconst defaultScrollScale = 1500;\nexport default function DemoScroll() {\n  _s();\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n  const [isTheatreLoading, setTheatreLoading] = useState(true);\n\n  //可以播放條件：\n  // 1. project ready\n  // 2. 圖片 src 載入完成\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n  const sequenceLength = val(sheet.sequence.pointer.length); //播放總時間長度\n  const stageRef = useRef(null);\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const viewbox = stage.closest('.theatre-scroll-viewbox');\n      const stageRect = stage.getBoundingClientRect();\n      const viewboxRect = viewbox.getBoundingClientRect();\n      const distance = stageRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n  useEffect(() => {\n    const newPosition = scrollPosition / (sequenceLength * defaultScrollScale) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n  const objJson = localStorage.getItem('theatre-data'); // get objectJSON in local-storage\n  const objData = objJson ? JSON.parse(objJson) : [];\n  const screenWidth = window.innerWidth;\n\n  // ----------------------------\n\n  // 1. 處理單純內容 loading\n  let loadingJsx = null;\n  // if (videoDuration === 0 && isVideoLoading) {\n  //   loadingJsx = (\n  //     <Dimmer show={isVideoLoading} message='捲動式影片載入中' shining />\n  //   );\n  // } else if (isVideoLoading) {\n  //   // 已經有影片，但影片正在跑\n  //   loadingJsx = <Spinner />;\n  // }\n\n  if (isTheatreLoading) {\n    loadingJsx = /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 18\n    }, this);\n  }\n\n  //   <Dimmer\n  //   show={isVideoError}\n  //   message={\n  //     '捲動式影片影片載入失敗。請檢查您的網路連線，並重新整理瀏覽器。若您的瀏覽器不支援捲動式影片，請使用較新版 Firefox、Chrome、Safari、或 Edge 瀏覽器觀看。'\n  //   }\n  // />\n  // <Dimmer\n  //   show={isScrollTriggerError}\n  //   message={\n  //     '您的瀏覽器不支援捲動式影片，請使用較新版 Firefox、Chrome、Safari、或 Edge 瀏覽器觀看。'\n  //   }\n  // />\n\n  return /*#__PURE__*/_jsxDEV(ViewBox, {\n    className: \"theatre-scroll-viewbox\",\n    style: {\n      height: `${sequenceLength * defaultScrollScale}px`\n    },\n    children: /*#__PURE__*/_jsxDEV(StageWrapper, {\n      ref: stageRef,\n      children: [loadingJsx, /*#__PURE__*/_jsxDEV(Stage, {\n        objData: objData,\n        sheet: sheet,\n        stageWidth: screenWidth,\n        draggable: false,\n        setTheatreLoading: setTheatreLoading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n}\n_s(DemoScroll, \"Se8m78DEl+EQXgEPhXlVEA/Ffxs=\");\n_c4 = DemoScroll;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"ViewBox\");\n$RefreshReg$(_c2, \"StageWrapper\");\n$RefreshReg$(_c3, \"Spinner\");\n$RefreshReg$(_c4, \"DemoScroll\");","map":{"version":3,"names":["studio","val","getProject","useState","useEffect","useRef","styled","Stage","Dimmer","jsxDEV","_jsxDEV","ViewBox","div","_c","StageWrapper","_c2","Spinner","SpinnerBlock","children","viewBox","version","xmlns","xmlnsXlink","stroke","strokeWidth","fill","fillRule","d","fileName","_jsxFileName","lineNumber","columnNumber","_c3","defaultScrollScale","DemoScroll","_s","initialize","ui","hide","project","sheet","isTheatreLoading","setTheatreLoading","ready","then","sequence","pause","scrollPosition","setScrollPosition","sequenceLength","pointer","length","stageRef","handleScroll","stage","current","viewbox","closest","stageRect","getBoundingClientRect","viewboxRect","distance","top","window","addEventListener","removeEventListener","newPosition","position","objJson","localStorage","getItem","objData","JSON","parse","screenWidth","innerWidth","loadingJsx","className","style","height","ref","stageWidth","draggable","_c4","$RefreshReg$"],"sources":["/Users/mac/Documents/GitHub/deepfake-demo/src/page/demo-scroll.js"],"sourcesContent":["import studio from '@theatre/studio';\nimport { val, getProject } from '@theatre/core';\nimport { useState, useEffect, useRef } from 'react';\nimport styled from 'styled-components';\nimport Stage from '../components/stage';\nimport Dimmer from '../components/dimmer-with-message';\n\nconst ViewBox = styled.div`\n  position: relative;\n  width: 100vw;\n  min-width: 100vw;\n  max-width: 100vw;\n  min-height: 100vh;\n  background: #ffffff;\n`;\n\nconst StageWrapper = styled.div`\n  width: 100%;\n  height: 100vh;\n  position: sticky;\n  top: 0;\n  left: 0;\n`;\n\nfunction Spinner() {\n  return (\n    <SpinnerBlock>\n      <svg\n        viewBox='0 0 20 20'\n        version='1.1'\n        xmlns='http://www.w3.org/2000/svg'\n        xmlnsXlink='http://www.w3.org/1999/xlink'\n      >\n        <g stroke='none' strokeWidth='1' fill='none' fillRule='evenodd'>\n          <g fill='#fff' fillRule='nonzero'>\n            <path d='M10,3.5 C6.41015,3.5 3.5,6.41015 3.5,10 C3.5,10.4142 3.16421,10.75 2.75,10.75 C2.33579,10.75 2,10.4142 2,10 C2,5.58172 5.58172,2 10,2 C14.4183,2 18,5.58172 18,10 C18,14.4183 14.4183,18 10,18 C9.58579,18 9.25,17.6642 9.25,17.25 C9.25,16.8358 9.58579,16.5 10,16.5 C13.5899,16.5 16.5,13.5899 16.5,10 C16.5,6.41015 13.5899,3.5 10,3.5 Z'></path>\n          </g>\n        </g>\n      </svg>\n    </SpinnerBlock>\n  );\n}\n\nconst defaultScrollScale = 1500;\n\nexport default function DemoScroll() {\n  studio.initialize();\n  studio.ui.hide();\n  const project = getProject('Project', {});\n  const sheet = project.sheet('Scene', 'default');\n\n  const [isTheatreLoading, setTheatreLoading] = useState(true);\n\n  //可以播放條件：\n  // 1. project ready\n  // 2. 圖片 src 載入完成\n  project.ready.then(() => sheet.sequence.pause());\n\n  // --------------------------\n  // TODO: 增加條件，減少 event-listener 偵測時間\n\n  const [scrollPosition, setScrollPosition] = useState(0);\n\n  const sequenceLength = val(sheet.sequence.pointer.length); //播放總時間長度\n  const stageRef = useRef(null);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const stage = stageRef.current;\n      const viewbox = stage.closest('.theatre-scroll-viewbox');\n\n      const stageRect = stage.getBoundingClientRect();\n      const viewboxRect = viewbox.getBoundingClientRect();\n\n      const distance = stageRect.top - viewboxRect.top;\n      setScrollPosition(distance);\n    };\n\n    window.addEventListener('scroll', handleScroll);\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    const newPosition =\n      (scrollPosition / (sequenceLength * defaultScrollScale)) * sequenceLength;\n    sheet.sequence.position = newPosition;\n  }, [scrollPosition]);\n\n  const objJson = localStorage.getItem('theatre-data'); // get objectJSON in local-storage\n  const objData = objJson ? JSON.parse(objJson) : [];\n\n  const screenWidth = window.innerWidth;\n\n  // ----------------------------\n\n  // 1. 處理單純內容 loading\n  let loadingJsx = null;\n  // if (videoDuration === 0 && isVideoLoading) {\n  //   loadingJsx = (\n  //     <Dimmer show={isVideoLoading} message='捲動式影片載入中' shining />\n  //   );\n  // } else if (isVideoLoading) {\n  //   // 已經有影片，但影片正在跑\n  //   loadingJsx = <Spinner />;\n  // }\n\n  if (isTheatreLoading) {\n    loadingJsx = <Spinner />;\n  }\n\n  //   <Dimmer\n  //   show={isVideoError}\n  //   message={\n  //     '捲動式影片影片載入失敗。請檢查您的網路連線，並重新整理瀏覽器。若您的瀏覽器不支援捲動式影片，請使用較新版 Firefox、Chrome、Safari、或 Edge 瀏覽器觀看。'\n  //   }\n  // />\n  // <Dimmer\n  //   show={isScrollTriggerError}\n  //   message={\n  //     '您的瀏覽器不支援捲動式影片，請使用較新版 Firefox、Chrome、Safari、或 Edge 瀏覽器觀看。'\n  //   }\n  // />\n\n  return (\n    <ViewBox\n      className='theatre-scroll-viewbox'\n      style={{ height: `${sequenceLength * defaultScrollScale}px` }}\n    >\n      <StageWrapper ref={stageRef}>\n        {loadingJsx}\n        <Stage\n          objData={objData}\n          sheet={sheet}\n          stageWidth={screenWidth}\n          draggable={false}\n          setTheatreLoading={setTheatreLoading}\n        />\n      </StageWrapper>\n    </ViewBox>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}